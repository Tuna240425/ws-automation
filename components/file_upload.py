import streamlit as st
from config import FILE_CONFIG
from utils.session_manager import next_step
from utils.file_handler import process_uploaded_file

def render_file_upload_page():
    """1λ‹¨κ³„: μΈν„°λ·° μ—…λ΅λ“ νμ΄μ§€"""
    
    st.header("1οΈβƒ£ μΈν„°λ·° μ—…λ΅λ“")
    
    st.markdown("### π“ μ§μ› μΈν„°λ·° νμΌ μ—…λ΅λ“")
    st.markdown("μΈν„°λ·° λ€ν™”λ‚΄μ—­μ΄ λ‹΄κΈ΄ νμΌμ„ μ—…λ΅λ“ν•΄μ£Όμ„Έμ”. (ν…μ¤νΈ, μ›λ“, PDF λ“±)")
    
    # νμΌ μ—…λ΅λ”
    uploaded_file = st.file_uploader(
        "νμΌ μ„ νƒ",
        type=FILE_CONFIG["allowed_types"],
        help=FILE_CONFIG["upload_help"]
    )
    
    # λλ” μ§μ ‘ ν…μ¤νΈ μ…λ ¥
    st.markdown("### βοΈ λλ” μ§μ ‘ μ…λ ¥")
    direct_input = st.text_area(
        "μΈν„°λ·° λ‚΄μ©μ„ μ§μ ‘ μ…λ ¥ν•μ„Έμ”",
        height=300,
        placeholder="μΈν„°λ·° λ€ν™”λ‚΄μ©μ„ μ—¬κΈ°μ— λ¶™μ—¬λ„£κ±°λ‚ μ…λ ¥ν•μ„Έμ”...",
        key="direct_input"
    )
    
    # νμΌ μ²λ¦¬ λλ” μ§μ ‘ μ…λ ¥ μ²λ¦¬
    if uploaded_file or direct_input.strip():
        if uploaded_file:
            try:
                content = process_uploaded_file(uploaded_file)
                st.session_state.interview_content = content
                st.session_state.interview_file = uploaded_file.name
                st.success(f"β… νμΌ '{uploaded_file.name}'μ΄ μ„±κ³µμ μΌλ΅ μ—…λ΅λ“λμ—μµλ‹λ‹¤.")
            except Exception as e:
                st.error(f"β νμΌ μ²λ¦¬ μ¤‘ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤: {str(e)}")
                return
        else:
            st.session_state.interview_content = direct_input
            st.session_state.interview_file = "μ§μ ‘ μ…λ ¥"
            st.success("β… ν…μ¤νΈκ°€ μ„±κ³µμ μΌλ΅ μ…λ ¥λμ—μµλ‹λ‹¤.")
        
        # μ—…λ΅λ“λ λ‚΄μ© λ―Έλ¦¬λ³΄κΈ°
        with st.expander("π“‹ μ—…λ΅λ“λ μΈν„°λ·° λ‚΄μ© λ―Έλ¦¬λ³΄κΈ°", expanded=False):
            preview_content = st.session_state.interview_content[:1000]
            if len(st.session_state.interview_content) > 1000:
                preview_content += "\n\n... (λ” λ§μ€ λ‚΄μ©μ΄ μμµλ‹λ‹¤)"
            st.text(preview_content)
        
        # λ‹¤μ λ‹¨κ³„ λ²„νΌ
        if st.button("π” μ½ν…μΈ  μ†μ¬ λ„μ¶ν•κΈ°", type="primary", use_container_width=True):
            if st.session_state.interview_content.strip():
                next_step()
            else:
                st.error("μΈν„°λ·° λ‚΄μ©μ΄ λΉ„μ–΄μμµλ‹λ‹¤.")
    
    else:
        st.info("π“ νμΌμ„ μ—…λ΅λ“ν•κ±°λ‚ μ§μ ‘ ν…μ¤νΈλ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”.")
        
        # μƒν” λ°μ΄ν„° λ²„νΌ (ν…μ¤νΈμ©)
        if st.button("π― μƒν” λ°μ΄ν„°λ΅ ν…μ¤νΈν•κΈ°", help="ν…μ¤νΈμ© μƒν” μΈν„°λ·° λ°μ΄ν„°λ¥Ό λ΅λ“ν•©λ‹λ‹¤"):
            sample_content = get_sample_interview()
            st.session_state.interview_content = sample_content
            st.session_state.interview_file = "μƒν” λ°μ΄ν„°"
            st.success("β… μƒν” λ°μ΄ν„°κ°€ λ΅λ“λμ—μµλ‹λ‹¤.")
            st.rerun()

def get_sample_interview():
    """ν…μ¤νΈμ© μƒν” μΈν„°λ·° λ°μ΄ν„°"""
    return """
[BGN λ°μ€λμ•κ³Ό μ§μ› μΈν„°λ·° - 2024.08.20]

Q: μµκ·Όμ— κΈ°μ–µμ— λ‚¨λ” ν™μ μΌ€μ΄μ¤κ°€ μλ‚μ”?

A: λ„¤, μ§€λ‚μ£Όμ— 50λ€ μ£Όλ¶€λ¶„μ΄ μ¤μ…¨λ”λ°μ”. λ°±λ‚΄μ¥μ΄ λ§μ΄ μ§„ν–‰λμ–΄μ„ μΌμƒμƒν™μ΄ μ •λ§ λ¶νΈν•μ…¨μ–΄μ”. 
μ”λ¦¬ν•μ‹¤ λ• μΉΌμ§ν•λ” κ²ƒλ„ λ¬΄μ„μ›ν•μ‹κ³ , TV μ‹μ²­λ„ μ λ€λ΅ λ» ν•μ…¨λ‹¤κ³  ν•λ”λΌκµ¬μ”. 
μμ  ν›„μ—λ” μ •λ§ μƒ μ„Έμƒμ„ λ³Έ κ²ƒ κ°™λ‹¤λ©° λλ¬Όμ„ νλ¦¬μ…¨μ–΄μ”.

Q: κ²€μ‚¬ κ³Όμ •μ—μ„ ν™μλ“¤μ΄ κ°€μ¥ κ¶κΈν•΄ν•λ” κ²ƒμ€ λ¬΄μ—‡μΈκ°€μ”?

A: μ•μ €κ²€μ‚¬ν•  λ• "μ™ μ΄λ° κ²€μ‚¬λ¥Ό ν•λ”μ§€" λ§μ΄ λ¬Όμ–΄λ³΄μ„Έμ”. 
νΉν μ μ€ λ¶„λ“¤μ€ "λμ— λ³„ λ¬Έμ μ—†λ”λ° μ™ μ΄λ ‡κ² μμ„Έν λ³΄λƒ"κ³  ν•μ‹λ”λ°, 
λ§λ§‰ μ§ν™μ€ μ΅°κΈ° λ°κ²¬μ΄ μ •λ§ μ¤‘μ”ν•λ‹¤κ³  μ„¤λ…λ“λ¦¬λ©΄ μ΄ν•΄ν•΄μ£Όμ„Έμ”.

Q: λ³‘μ› λ¶„μ„κΈ°λ‚ μ΄μμ—μ„ νΉλ³„ν• μ μ΄ μλ‹¤λ©΄?

A: μ €ν¬λ” λ€κΈ°μ‹κ°„μ„ μµλ€ν• μ¤„μ΄λ ¤κ³  λ…Έλ ¥ν•΄μ”. 
μμ•½ μ‹μ¤ν…μ„ μ •λ§ μ²΄κ³„μ μΌλ΅ κ΄€λ¦¬ν•κ³ , ν™μλ¶„λ“¤μ΄ κΈ°λ‹¤λ¦¬μ‹λ” λ™μ• 
λ¶νΈν•μ§€ μ•λ„λ΅ νΈμ•ν• μμμ™€ μ°¨λ¶„ν• μμ•…λ„ μ‹ κ²½μ¨μ„ μ¤€λΉ„ν–μ–΄μ”.

Q: μ²μ μ΄κ³³μ—μ„ μΌν•  λ• μ–΄λ ¤μ› λ μ μ€?

A: μ²μμ—λ” ν™μλ¶„λ“¤κ» κ²€μ‚¬ μ„¤λ…ν•  λ• λ„λ¬΄ μν•™μ μΈ μ©μ–΄λ¥Ό λ§μ΄ μΌμ–΄μ”. 
ν• λ²μ€ ν• λ¨Έλ‹κ»μ„ "λ¬΄μ¨ λ§μΈμ§€ ν•λ‚λ„ λ¨λ¥΄κ² λ‹¤"κ³  ν•μ…”μ„ μ •λ§ λ°μ„±ν–μ–΄μ”. 
κ·Έ ν›„λ΅λ” μ‰¬μ΄ λ§λ΅ μ„¤λ…ν•λ ¤κ³  λ…Έλ ¥ν•κ³  μμ–΄μ”.

Q: ν™μλ“¤μ΄ μμ£Ό ν•λ” μ§λ¬Έμ΄ μλ‚μ”?

A: "λΌμ‹ μμ  ν›„ μ–Έμ λ¶€ν„° μ΄λ™ν•  μ μλ‚μ”?"κ°€ κ°€μ¥ λ§μ€ μ§λ¬Έμ΄μ—μ”. 
νΉν ν—¬μ¤μ¥ λ‹¤λ‹μ‹λ” λ¶„λ“¤μ΄λ‚ κ³¨ν”„μΉμ‹λ” λ¶„λ“¤μ΄ μ •λ§ λ§μ΄ λ¬Όμ–΄λ³΄μ„Έμ”. 
λ μ•κµ¬κ±΄μ΅°μ¦ ν™μλ¶„λ“¤μ€ "μΈκ³µλλ¬Ό μ–Έμ κΉμ§€ λ„£μ–΄μ•Ό ν•λ‚μ”?"λ„ μμ£Ό λ¬Όμ–΄λ³΄μ‹κ³ μ”.

Q: μλ£μ§„ κµμ΅μ΄λ‚ ν•™μµμ€ μ–΄λ–»κ² μ΄λ£¨μ–΄μ§€λ‚μ”?

A: μ›μ¥λ‹μ΄ μ •λ§ κ³µλ¶€λ¥Ό κ°•μ΅°ν•μ„Έμ”. λ§¤μ›” ν•™ν μ°Έμ„ν•μ‹κ³ , 
μ €ν¬μ—κ²λ„ μµμ‹  μλ£ λ™ν–¥μ„ ν•­μƒ κ³µμ ν•΄μ£Όμ„Έμ”. 
μƒλ΅μ΄ μ¥λΉ„ λ“¤μ–΄μ¤λ©΄ μ „μ²΄ μ¤νƒν”„ κµμ΅λ„ μ² μ €ν ν•κ³ μ”.
"""